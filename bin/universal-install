#!/bin/bash

# Universal Install Script
# At the moment only has support for macOS and Arch Linux
# https://xkcd.com/1654/

COMMAND=$1
ARCHLINUX_PROGRAM=$2
MACOS_PROGRAM=${3:-$2}
CASK=$4

OS=$(uname -s)

case "$OS" in

  Darwin)
    PROGRAM=$MACOS_PROGRAM
    INSTALLER="brew"
    if [[ $CASK == 'cask' ]]; then
      INSTALL="brew cask install $PROGRAM"
    else
      INSTALL="brew install $PROGRAM"
    fi
    ;;

  Linux)
    PROGRAM=$ARCHLINUX_PROGRAM
    INSTALLER="pacman"
    INSTALL="sudo pacman -S $PROGRAM"
    ;;

  *)
    >&2 echo "$OS is not supported for installation."
    exit 1
    ;;

esac

if ! type $COMMAND > /dev/null 2>&1; then
  if ! type $INSTALLER > /dev/null 2>&1; then
    >&2 echo "$PROGRAM cannot be installed because $INSTALLER doesn't exist." \
      "Please install $INSTALLER and try again."
    exit 1
  else
    echo "Installing $PROGRAM"
    $INSTALL
  fi
else
  echo "$PROGRAM is already installed"
fi

